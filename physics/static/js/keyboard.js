function manageCharInterception(e,t,n){e.preventDefault();switch(t){case 1:incommingString=$("#char_"+n).val();manageBtnLooks(t,n);if(keyboardLanguage=="vi"){if(keyboardMode=="1"){if(n==53){manageBtnLooks(0,n);$("#char_"+n).css("background-position","0px 0px");manageVietAccent(1)}else if(n==54){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-30px 0px");manageVietAccent(2)}else if(n==55){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-60px 0px");manageVietAccent(3)}else if(n==56){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-90px 0px");manageVietAccent(4)}else if(n==57){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-120px 0px");manageVietAccent(5)}else{insertString(incommingString)}}else if(keyboardMode=="2"){if(n==49){manageBtnLooks(0,n);$("#char_"+n).css("background-position","0px 0px");manageVietAccent(1)}else if(n==50){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-30px 0px");manageVietAccent(2)}else if(n==51){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-60px 0px");manageVietAccent(3)}else if(n==52){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-90px 0px");manageVietAccent(4)}else if(n==53){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-120px 0px");manageVietAccent(5)}else if(n==54){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-150px 0px");manageVietAccent(6)}else if(n==55){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-180px 0px");manageVietAccent(7)}else if(n==56){manageBtnLooks(0,n);$("#char_"+n).css("background-position","-210px 0px");manageVietAccent(8)}else if(n==57){manageBtnLooks(1,n);manageVietAccent(9)}else{doubleTapped=manageDoubleTap(incommingString);if(doubleTapped==false){insertString(incommingString)}}}}else{insertString(incommingString)}break;case 0:manageBtnLooks(t,n);break}}function manageBtnLooks(e,t){switch(e){case 1:$("#char_"+t).css("background","#1A8BA9");$("#char_"+t).css("font-weight","bold");$("#char_"+t).css("color","#fff");$("#char_"+t).css("border-color","#fff");$("#char_"+t).css("border-width","1px");break;case 0:$("#char_"+t).css("background","");$("#char_"+t).css("font-weight","normal");$("#char_"+t).css("color","#525252");$("#char_"+t).css("border-color","");$("#char_"+t).css("border-width","");break}}function getCaret(){canvas=document.getElementById("content");var e="";sel=document.selection.createRange();dul=sel.duplicate();len=0;dul.moveToElementText(canvas);sel.text=e;len=dul.text.indexOf(e);sel.moveStart("character",-1);sel.text="";return len}function setSelectionRange(e,t,n){var r=e.createTextRange();r.collapse(true);r.moveEnd("character",n);r.moveStart("character",t);r.select()}function setCaretToPos(e){canvas=document.getElementById("content");setSelectionRange(canvas,e,e)}function manageBackspace(){canvas=document.getElementById("content");canvas.focus();if(typeof document.selection!="undefined"){caret=getCaret();if(caret==-1){caret=canvas.value.length}if(canvas.value.substr(caret-1,1)=="\n"){erace=2}else{erace=1}begining=canvas.value.substr(0,caret-erace);ending=canvas.value.substr(caret,canvas.value.length);canvas.value=begining+ending;cptr=0;for(k=0;k<caret-1;k++){if(canvas.value[k]=="\n"){cptr++}}setCaretToPos(caret-(erace+cptr))}else if(typeof canvas.selectionStart!="undefined"){begining=canvas.selectionStart;ending=canvas.selectionEnd;canvas.value=canvas.value.substr(0,begining-1)+canvas.value.substr(ending);pos=begining-1;canvas.selectionStart=pos;canvas.selectionEnd=pos}else{canvas.value=canvas.value.substr(0,canvas.value.length-1)}canvas.focus()}function manageChar(e){incommingString=e.value;if(keyboardLanguage=="vi"&&keyboardMode=="2"){doubleTapped=manageDoubleTap(incommingString);if(doubleTapped==false){insertString(incommingString)}}else{insertString(incommingString)}}function manageEnter(){insertString("\n")}function manageSpace(){insertString(" ")}function manageCaps(){switch(capsMode){case 0:capsMode=1;manageKeyboard(1);break;case 1:capsMode=0;manageKeyboard(0);break}manageCapsBtnLooks()}function manageCapsBtnLooks(){switch(capsMode){case 1:$("#btn_caps").css("color","#1A8BA9");break;case 0:$("#btn_caps").css("color","#525252");break}}function manageFont(e){e=parseInt(e,10);canvas=document.getElementById("content");currentFont=parseInt(canvas.style.fontSize,10);currentHeight=parseInt(canvas.style.lineHeight,10);if(currentFont+e<30&&currentFont+e>8){canvas.style.fontSize=currentFont+e+"px";canvas.style.lineHeight=currentHeight+e+"px"}return}function defaultFont(){canvas=document.getElementById("content");canvas.style.fontSize=textareaFontSize+"px";canvas.style.lineHeight=textareaLineHeight+"px"}function manageSelect(){document.getElementById("content").select()}function manageInterception(e){interceptKey=e;refocus()}$(document).ready(function(){shiftIsPressed=false;ctrlIsPressed=false;capsMode=0;ie9=false;safari=false;});$(document).keydown(function(e){if(e.keyCode==16){if(shiftIsPressed==false){shiftIsPressed=true;switch(capsMode){case 0:manageKeyboard(1);break;case 1:manageKeyboard(0);break}}}if(e.keyCode==17){ctrlIsPressed=true}if(interceptKey==true){if(ctrlIsPressed==false){if(safari==true){if(e.keyCode==192){manageCharInterception(e,1,222)}}else{if(e.keyCode==192){manageCharInterception(e,1,192)}}if(e.keyCode==163){manageCharInterception(e,1,192)}if(e.keyCode==49){manageCharInterception(e,1,49)}if(e.keyCode==50){manageCharInterception(e,1,50)}if(e.keyCode==51){manageCharInterception(e,1,51)}if(e.keyCode==52){manageCharInterception(e,1,52)}if(e.keyCode==53){manageCharInterception(e,1,53)}if(e.keyCode==54){manageCharInterception(e,1,54)}if(e.keyCode==55){manageCharInterception(e,1,55)}if(e.keyCode==56){manageCharInterception(e,1,56)}if(e.keyCode==57){manageCharInterception(e,1,57)}if(e.keyCode==48){manageCharInterception(e,1,48)}if(e.keyCode==173){manageCharInterception(e,1,173)}if(e.keyCode==189){manageCharInterception(e,1,173)}if(e.keyCode==61){manageCharInterception(e,1,61)}if(e.keyCode==187){manageCharInterception(e,1,61)}if(e.keyCode==81){manageCharInterception(e,1,81)}if(e.keyCode==87){manageCharInterception(e,1,87)}if(e.keyCode==69){manageCharInterception(e,1,69)}if(e.keyCode==82){manageCharInterception(e,1,82)}if(e.keyCode==84){manageCharInterception(e,1,84)}if(e.keyCode==89){manageCharInterception(e,1,89)}if(e.keyCode==85){manageCharInterception(e,1,85)}if(e.keyCode==73){manageCharInterception(e,1,73)}if(e.keyCode==79){manageCharInterception(e,1,79)}if(e.keyCode==80){manageCharInterception(e,1,80)}if(e.keyCode==160){manageCharInterception(e,1,160)}if(e.keyCode==219){manageCharInterception(e,1,160)}if(e.keyCode==221){manageCharInterception(e,1,221)}if(e.keyCode==220){manageCharInterception(e,1,220)}if(e.keyCode==65){manageCharInterception(e,1,65)}if(e.keyCode==83){manageCharInterception(e,1,83)}if(e.keyCode==68){manageCharInterception(e,1,68)}if(e.keyCode==70){manageCharInterception(e,1,70)}if(e.keyCode==71){manageCharInterception(e,1,71)}if(e.keyCode==72){manageCharInterception(e,1,72)}if(e.keyCode==74){manageCharInterception(e,1,74)}if(e.keyCode==75){manageCharInterception(e,1,75)}if(e.keyCode==76){manageCharInterception(e,1,76)}if(e.keyCode==59){manageCharInterception(e,1,59)}if(e.keyCode==186){manageCharInterception(e,1,59)}if(safari==true){if(e.keyCode==222){manageCharInterception(e,1,192)}}else{if(e.keyCode==222){manageCharInterception(e,1,222)}}if(e.keyCode==90){manageCharInterception(e,1,90)}if(e.keyCode==88){manageCharInterception(e,1,88)}if(e.keyCode==67){manageCharInterception(e,1,67)}if(e.keyCode==86){manageCharInterception(e,1,86)}if(e.keyCode==66){manageCharInterception(e,1,66)}if(e.keyCode==78){manageCharInterception(e,1,78)}if(e.keyCode==77){manageCharInterception(e,1,77)}if(e.keyCode==188){manageCharInterception(e,1,188)}if(e.keyCode==190){manageCharInterception(e,1,190)}if(e.keyCode==191){manageCharInterception(e,1,191)}}}});$(document).keyup(function(e){if(e.keyCode==16){shiftIsPressed=false;switch(capsMode){case 0:manageKeyboard(0);break;case 1:manageKeyboard(1);break}}if(e.keyCode==17){ctrlIsPressed=false}if(interceptKey==true){if(safari==true){if(e.keyCode==192){manageCharInterception(e,0,222)}}else{if(e.keyCode==192){manageCharInterception(e,0,192)}}if(e.keyCode==163){manageCharInterception(e,0,192)}if(e.keyCode==49){manageCharInterception(e,0,49)}if(e.keyCode==50){manageCharInterception(e,0,50)}if(e.keyCode==51){manageCharInterception(e,0,51)}if(e.keyCode==52){manageCharInterception(e,0,52)}if(e.keyCode==53){manageCharInterception(e,0,53)}if(e.keyCode==54){manageCharInterception(e,0,54)}if(e.keyCode==55){manageCharInterception(e,0,55)}if(e.keyCode==56){manageCharInterception(e,0,56)}if(e.keyCode==57){manageCharInterception(e,0,57)}if(e.keyCode==48){manageCharInterception(e,0,48)}if(e.keyCode==173){manageCharInterception(e,0,173)}if(e.keyCode==189){manageCharInterception(e,0,173)}if(e.keyCode==187){manageCharInterception(e,0,61)}if(e.keyCode==61){manageCharInterception(e,0,61)}if(e.keyCode==81){manageCharInterception(e,0,81)}if(e.keyCode==87){manageCharInterception(e,0,87)}if(e.keyCode==69){manageCharInterception(e,0,69)}if(e.keyCode==82){manageCharInterception(e,0,82)}if(e.keyCode==84){manageCharInterception(e,0,84)}if(e.keyCode==89){manageCharInterception(e,0,89)}if(e.keyCode==85){manageCharInterception(e,0,85)}if(e.keyCode==73){manageCharInterception(e,0,73)}if(e.keyCode==79){manageCharInterception(e,0,79)}if(e.keyCode==80){manageCharInterception(e,0,80)}if(e.keyCode==160){manageCharInterception(e,0,160)}if(e.keyCode==219){manageCharInterception(e,0,160)}if(e.keyCode==221){manageCharInterception(e,0,221)}if(e.keyCode==220){manageCharInterception(e,0,220)}if(e.keyCode==65){manageCharInterception(e,0,65)}if(e.keyCode==83){manageCharInterception(e,0,83)}if(e.keyCode==68){manageCharInterception(e,0,68)}if(e.keyCode==70){manageCharInterception(e,0,70)}if(e.keyCode==71){manageCharInterception(e,0,71)}if(e.keyCode==72){manageCharInterception(e,0,72)}if(e.keyCode==74){manageCharInterception(e,0,74)}if(e.keyCode==75){manageCharInterception(e,0,75)}if(e.keyCode==76){manageCharInterception(e,0,76)}if(e.keyCode==59){manageCharInterception(e,0,59)}if(e.keyCode==186){manageCharInterception(e,0,59)}if(safari==true){if(e.keyCode==222){manageCharInterception(e,0,192)}}else{if(e.keyCode==222){manageCharInterception(e,0,222)}}if(e.keyCode==90){manageCharInterception(e,0,90)}if(e.keyCode==88){manageCharInterception(e,0,88)}if(e.keyCode==67){manageCharInterception(e,0,67)}if(e.keyCode==86){manageCharInterception(e,0,86)}if(e.keyCode==66){manageCharInterception(e,0,66)}if(e.keyCode==78){manageCharInterception(e,0,78)}if(e.keyCode==77){manageCharInterception(e,0,77)}if(e.keyCode==188){manageCharInterception(e,0,188)}if(e.keyCode==190){manageCharInterception(e,0,190)}if(e.keyCode==191){manageCharInterception(e,0,191)}}})
var focused_element=null;
var focused_element_id = null;
function get_focus(id){
	focused_element_id = id;
	console.log("The value is "+id);
	focused_element = document.getElementById(id);
	$(focused_element_id).focus()
}
function refocus(){
	$(focused_element_id).focus()
}
function insertString(e){
	canvas=document.getElementById(focused_element_id);
	console.log(canvas);
	if(typeof document.selection!="undefined"){
		caret=getCaret();
		if(caret==-1){
			caret=canvas.value.length
		}
		begining=canvas.value.substr(0,caret);
		ending=canvas.value.substr(caret,canvas.value.length);
		canvas.value=begining+e+ending;
		cptr=0;
		for(k=0;k<caret;k++){
			if(canvas.value[k]=="\n"){
				if(ie9!=true){
					cptr++
				}else{

				}
			}
		}
		setCaretToPos(caret-(cptr-1))
	}else if(typeof canvas.selectionStart!="undefined"){
		begining=canvas.selectionStart;ending=canvas.selectionEnd;
		canvas.value=canvas.value.substr(0,begining)+e+canvas.value.substr(ending);
		pos=begining+e.length;
		canvas.selectionStart=pos;
		canvas.selectionEnd=pos;
		canvas.scrollTop=canvas.scrollHeight
	}else{
		canvas.value=canvas.value+e
	}
}